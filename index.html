<p>Valor mostrat: <code>window.addEventListener('message', function(event)</code></p>
<div id="received-message-display" style="margin-top: 10px; padding: 10px; border: 1px solid #ccc; background-color: #f9f9f9; font-family: monospace; white-space: pre-wrap; word-break: break-all; border-radius: 4px;">
    Esperant missatges de l'iframe...
</div>
<iframe
    id="my-calendar-iframe"
    src="https://rcasfor.github.io/"
    width="100%"
    frameborder="0"
    allowfullscreen
    style="border: none; border-radius: 8px; box-shadow: 0 4px 6px rgba{0, 0, 0, 0.1); height: 800px;" /* Initial height, will be overridden by JS */
>
</iframe>

<script>
    const receivedMessageDisplay = document.getElementById('received-message-display');
    const iframeId = 'my-calendar-iframe'; // Define the ID of your iframe

    // Listen for messages from the iframe
    window.addEventListener('message', function(event) {
        // IMPORTANT: For security, verify the origin of the message
        // if (event.origin !== "https://rcasfor.github.io") {
        //     return; // Discard messages from untrusted origins
        // }

        // --- AFEGIT PER DEPURACIÓ: Registra tots els missatges rebuts ---
        console.log('Missatge rebut al pare (raw):', event);
        // ---------------------------------------------------------------

        // Check if the message data is an object, contains the correct iframeId,
        // and has a valid numeric 'height' property.
        if (event.data && typeof event.data === 'object' && event.data.iframeId === iframeId && typeof event.data.height === 'number' && !isNaN(event.data.height)) {
            const iframe = document.getElementById(iframeId);
            if (iframe) {
                // Set the iframe's height to the received height
                iframe.style.height = event.data.height + 'px';
            }
            // Display only the height value in pixels
            receivedMessageDisplay.textContent = 'Alçada del calendari: ' + event.data.height + 'px';
            // --- NOU LOG PER CONFIRMAR L'ACTUALITZACIÓ DEL DIV ---
            console.log('DIV actualitzat amb alçada vàlida:', event.data.height);
            // ------------------------------------------------------
        } else {
            // Display a message if the message is not from our iframe or doesn't contain valid height data
            receivedMessageDisplay.textContent = 'Missatge rebut: (no és del calendari o dades d\'alçada no vàlides)\nContingut del missatge: ' + JSON.stringify(event.data, null, 2);
            // --- NOU LOG PER CONFIRMAR L'ACTUALITZACIÓ DEL DIV ---
            console.log('DIV actualitzat amb missatge d\'error. Dades de l\'esdeveniment (no vàlides per al calendari):', event.data);
            // ------------------------------------------------------
        }
    });
</script>
